<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ordem de Serviço</title>
  <style>
    :root{
      --bg:#e8fffb;--brand-dark:#013d35;--brand-mid:#3db7ac;--white:#fff;--text:#0b1f1e;
      --radius-lg:16px;--radius-md:12px;--radius-sm:8px;--shadow:0 8px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--text);background:var(--bg);-webkit-text-size-adjust:100%}
    .app{max-width:680px;margin:16px auto;padding:16px}
    .card-header{background:var(--brand-dark);color:var(--white);padding:20px 16px;border-radius:var(--radius-lg);box-shadow:var(--shadow);text-align:center}
    .title{margin:0 0 4px;font-size:clamp(22px,5vw,36px);letter-spacing:.5px}
    .subtitle{margin:0;opacity:.9;font-weight:600;font-size:clamp(14px,3.4vw,18px)}
    .section-title{margin:20px 0 8px;background:#3db7ac;color:#0b1f1e;font-weight:800;letter-spacing:.5px;padding:10px 14px;border-radius:var(--radius-md)}
    .card{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:16px}
    .field{margin-bottom:14px}.label{display:block;font-weight:700;margin-bottom:8px}
    .control,.control2{display:block;width:100%;min-height:44px;font-size:16px;padding:10px 12px;border:1px solid #cfd8dc;border-radius:var(--radius-sm);background:#f9fafa;outline:none}
    .control2{padding:40px 12px}
    .control:focus,.control2:focus{border-color:var(--brand-mid);box-shadow:0 0 0 3px rgba(61,183,172,.25);background:#fff}
    input[type="datetime-local"].control{-webkit-appearance:none;appearance:none;max-width:100%;margin:0;padding-right:12px}
    .radio-group{display:grid;grid-template-columns:repeat(3,minmax(1,1fr));gap:10px;align-items:center}
    .radio-chip{display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid #cfd8dc;border-radius:var(--radius-sm);background:#f9fafa;min-height:44px;font-size:16px}
    .radio-chip input{width:18px;height:18px}
    .actions{margin-top:8px}
    .btn{width:100%;border:0;border-radius:12px;padding:28px 16px;font-weight:800;font-size:24px;color:#fff;background:var(--brand-dark);box-shadow:0 6px 14px rgba(1,61,53,.2);cursor:pointer}
    .btn:hover{filter:brightness(1.06)} .btn:active{transform:translateY(1px)}
    @media (max-width:420px){.app{padding:12px}.radio-group{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="app">
    <header class="card-header">
      <h1 class="title">ORDEM DE SERVIÇO</h1>
      <p class="subtitle">Abertura de OS</p>
    </header>

    <section class="card" aria-label="Formulário de OS">
      <form id="form-os" action="#" method="post" novalidate>
        <!-- DATA -->
        <h2 class="section-title">DATA</h2>
        <div class="field">
          <label for="dt-os" class="label">Data/Hora</label>
          <input id="dt-os" class="control" type="datetime-local" required placeholder="dd/mm/aaaa --:--"/>
        </div>

        <h2 class="section-title">LOCAL</h2>
        <div class="field">
          <label for="local" class="label">Local</label>
          <input id="local" name="local" class="control" list="localizacao" required placeholder="Digite ou escolha" />
          <datalist id="localizacao">
            <option value="FÁBRICA LINHA 2 - LPL">
            <option value="INTERMODAL - PDN">
          </datalist>
        </div>

        <!-- TIPO DE OS -->
        <h2 class="section-title">TIPO DE OS</h2>
        <div class="field">
          <div class="radio-group" role="radiogroup" aria-labelledby="tipo-os-label">
            <span id="tipo-os-label" class="sr-only" aria-hidden="true"></span>
            <label class="radio-chip"><input type="radio" name="tipoOS" value="corretiva" required /><span>Corretiva</span></label>
            <label class="radio-chip"><input type="radio" name="tipoOS" value="preventiva" /><span>Preventiva</span></label>
            <label class="radio-chip"><input type="radio" name="tipoOS" value="inspecao" /><span>Inspeção</span></label>
          </div>
        </div>

        <!-- PLACA -->
        <h2 class="section-title">PLACA</h2>
        <div class="field">
          <label for="placa" class="label">Placa</label>
          <input id="placa" name="placa" class="control" list="placas" required placeholder="Digite ou escolha" />
          <datalist id="placas">
            <option value="EMP0007"><option value="EMP0008"><option value="EMP0009"><option value="EMP0011">
            <option value="EMP0012"><option value="EMP0016"><option value="EMP0039"><option value="EMP0046">
            <option value="EMP0053"><option value="EMP0078"><option value="EMP0090"><option value="EMP0091">
            <option value="EMP0093"><option value="EMP0095"><option value="EMP0096"><option value="EMP0098"><option value="EMP0099">
          </datalist>
        </div>

        <!-- HORÍMETRO -->
        <h2 class="section-title">HORÍMETRO</h2>
        <div class="field">
          <label for="horimetro" class="label">Horímetro</label>
          <input id="horimetro" type="number" class="control" placeholder="Inserir km/horímetro do equipamento" inputmode="numeric" required />
        </div>

        <!-- CONJUNTO -->
        <h2 class="section-title">CONJUNTO</h2>
        <div class="field">
          <label for="conjunto" class="label">Conjunto</label>
          <input id="conjunto" name="conjunto" class="control" list="conjuntos" required placeholder="Digite ou escolha" />
          <datalist id="conjuntos">
            <option value="AJUSTES"><option value="CHASSI"><option value="CLAMP"><option value="CUBOS E FREIOS">
            <option value="DIREÇÃO"><option value="DIVERSOS"><option value="ELÉTRICA"><option value="INSPEÇÃO">
            <option value="MOTOR"><option value="ÓLEO"><option value="PNEUS E RODAS"><option value="PREVENTIVA 250H">
            <option value="PREVENTIVA 500H"><option value="PREVENTIVA 1000H"><option value="RADIADOR">
            <option value="SISTEMA DE ARREFECIMENTO"><option value="SISTEMA DE COMBUSTÍVEL"><option value="SISTEMA DE FREIOS">
            <option value="SISTEMA HIDRÁULICO"><option value="SISTEMA PNEUMÁTICO"><option value="SUSPENSÃO"><option value="TORRE">
            <option value="TRANSMISSÃO"><option value="VAZAMENTOS">
          </datalist>
        </div>

        <!-- DEFEITO -->
        <h2 class="section-title">DEFEITO / QUEBRA</h2>
        <div class="field">
          <label for="defeito" class="label">Descrição</label>
          <input id="defeito" type="text" class="control2" placeholder="Descrição da ocorrência" required />
        </div>

        <div class="actions">
          <button class="btn" id="btnRef" type="submit">Registrar</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    // ===== CONFIG =====
    const API_URL = "https://script.google.com/macros/s/AKfycbyxUVcvnGpmk3GxuqHkLYut8lb9BdnS_yS97oYqesNQ85z_FdonZRoOV2FtJClZWBywFg/exec";

    const form = document.getElementById('form-os');
    const btn = document.getElementById('btnRef');

    function limparCampos(){
      form.reset();
      // Em iOS, reset não limpa datetime; força limpeza:
      document.getElementById('dt-os').value = '';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validação simples
      const tipoSelecionado = document.querySelector('input[name="tipoOS"]:checked');
      if (!tipoSelecionado){
        alert('Selecione o tipo de OS.');
        return;
      }

      // Monta payload exatamente com os nomes das colunas da planilha
      const dados = {
        data: document.getElementById('dt-os').value,           // A
        local: document.getElementById('local').value,          // B
        tipo_os: tipoSelecionado.value,                         // C
        placa: document.getElementById('placa').value,          // D
        horimetro: document.getElementById('horimetro').value,  // E
        conjunto: document.getElementById('conjunto').value,    // F
        defeito_quebra: document.getElementById('defeito').value// G
      };

      btn.disabled = true;
      btn.textContent = 'Enviando...';

      try {
        // Envia como x-www-form-urlencoded (não dispara preflight/CORS)
        const body = 'dados=' + encodeURIComponent(JSON.stringify({
          action: 'salvarLancamentos',
          dados
        }));

        const resp = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body
        });

        const json = await resp.json();
        if (json.sucesso){
          alert('✅ Registro salvo com sucesso!');
          limparCampos();
        } else {
          alert('❌ Falha ao salvar: ' + (json.mensagem || 'erro desconhecido'));
        }
      } catch (err){
        console.error(err);
        alert('❌ Erro ao conectar ao servidor.');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Registrar';
      }
    });
  </script>
</body>
</html>

   